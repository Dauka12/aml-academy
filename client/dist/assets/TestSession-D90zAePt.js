import{b7 as Y,b8 as Z,r as l,bf as J,bd as K,bA as X,j as e,eP as _,E as ee,b3 as te,o as N,bp as f,ar as p,bj as v,bh as b,cZ as ne,eQ as se,f as re,c as ae,ao as Q,cV as F,cY as W,bk as ie,bl as oe,bm as le,bn as ce,bo as de,cW as ue}from"./index-CWPAtMRT.js";import{A as xe}from"./ArrowBack-Bn_KyZo2.js";import{a as me,R as he}from"./Radio-Cyy3ibt8.js";import{T as pe,u as fe}from"./useTestSessionManager-OPsabaX4.js";import{C as z}from"./Container-D7Kqj5xH.js";import{A as M}from"./Alert-B32ZBNp2.js";import"./OlympiadRoutes-DStoIL9r.js";import"./useOlympiadStore-ErJtcenK.js";function ge(n){return Y("MuiRadioGroup",n)}Z("MuiRadioGroup",["root","row","error"]);const je=n=>{const{classes:s,row:t,error:a}=n;return te({root:["root",t&&"row",a&&"error"]},ge,s)},be=l.forwardRef(function(s,t){const{actions:a,children:r,className:c,defaultValue:i,name:u,onChange:o,value:h,...x}=s,g=l.useRef(null),T=je(s),[y,C]=J({controlled:h,default:i,name:"RadioGroup"});l.useImperativeHandle(a,()=>({focus:()=>{let m=g.current.querySelector("input:not(:disabled):checked");m||(m=g.current.querySelector("input:not(:disabled)")),m&&m.focus()}}),[]);const w=K(t,g),S=X(u),R=l.useMemo(()=>({name:S,onChange(m){C(m.target.value),o&&o(m,m.target.value)},value:y}),[S,o,C,y]);return e.jsx(me.Provider,{value:R,children:e.jsx(_,{role:"radiogroup",ref:w,className:ee(T.root,c),...x,children:r})})}),ye=N(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),Ce=N(e.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),ve=({questions:n,currentIndex:s,answers:t,onQuestionSelect:a})=>{const r=new Set(t.map(c=>c.questionId));return e.jsxs(f,{children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Навигация по вопросам"}),e.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center",maxWidth:"100%"},children:n.map((c,i)=>{const u=r.has(c.id),o=i===s;return e.jsx(v,{variant:o?"contained":"outlined",color:u?"success":"primary",size:"small",onClick:()=>a(i),sx:{minWidth:"40px",height:"40px",p:0},children:i+1},c.id)})})]})},we=({question:n,selectedOptionId:s,onSelectOption:t})=>{const a=r=>{t(n.id,parseInt(r.target.value))};return e.jsxs(f,{children:[e.jsx(b,{elevation:0,sx:{p:3,mb:3,bgcolor:"#f8f9fa"},children:e.jsx(p,{variant:"h6",gutterBottom:!0,children:n.questionRus})}),e.jsx(ne,{component:"fieldset",sx:{width:"100%",mt:2},children:e.jsx(be,{value:(s==null?void 0:s.toString())||"",onChange:a,children:n.options.map(r=>e.jsx(b,{elevation:0,sx:{mb:2,p:2,border:"1px solid",borderColor:s===r.id?"primary.main":"divider",borderRadius:2,bgcolor:s===r.id?"primary.light":"white",transition:"all 0.2s"},children:e.jsx(se,{value:r.id.toString(),control:e.jsx(he,{color:"primary"}),label:e.jsx(p,{variant:"body1",sx:{fontWeight:s===r.id?600:400,color:s===r.id?"primary.dark":"text.primary"},children:r.nameRus}),sx:{width:"100%"}})},r.id))})})]})},Se=({remainingSeconds:n,onTimeExpired:s})=>{const[t,a]=l.useState(n);l.useEffect(()=>{a(n);const i=setInterval(()=>{a(u=>u<=1?(clearInterval(i),s&&s(),0):u-1)},1e3);return()=>clearInterval(i)},[n,s]);const r=i=>{const u=Math.floor(i/3600),o=Math.floor(i%3600/60),h=i%60;return u>0?`${u}:${o.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`:`${o}:${h.toString().padStart(2,"0")}`},c=()=>t<=60?"error":t<=300?"warning":"inherit";return e.jsxs(f,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(pe,{sx:{mr:1,color:c()}}),e.jsx(p,{variant:"h6",component:"div",color:c(),children:r(t)})]})},P=Q(f)(({theme:n})=>({minHeight:"100vh",backgroundImage:"linear-gradient(135deg, #1A2751 0%, #13203f 100%)",paddingTop:n.spacing(4),paddingBottom:n.spacing(6)})),I=Q(ue.div)(({theme:n})=>({backgroundColor:"#fff",borderRadius:24,padding:n.spacing(3),marginBottom:n.spacing(3),boxShadow:"0 12px 36px rgba(0, 0, 0, 0.12)"})),k=Q(v)(({theme:n})=>({borderRadius:14,padding:n.spacing(1.2,3),fontWeight:600,textTransform:"none"})),Pe=()=>{const{sessionId:n}=re(),s=ae(),{currentSession:t,loading:a,error:r,getExamSession:c,endExamSession:i,updateAnswer:u,isExamActive:o,getRemainingTime:h}=fe(),[x,g]=l.useState(0),[T,y]=l.useState(!1),[C,w]=l.useState(!1),[S,R]=l.useState(!1);l.useEffect(()=>{if(!n){s("/olympiad/dashboard");return}c(parseInt(n))},[n,c,s]),l.useEffect(()=>{if(!t)return;const d=h();d<=0&&o()&&E(),d<=60&&d>0?R(!0):R(!1)},[t,h,o]),l.useEffect(()=>{!a&&t&&!o()&&s("/olympiad/test-results/"+n)},[t,a,o,s,n]);const m=()=>{t&&x<t.examData.questions.length-1&&g(x+1)},$=()=>{x>0&&g(x-1)},L=(d,j)=>{t&&u(t.id,d,j)},E=async()=>{if(!(!n||!t))try{w(!0),await i(parseInt(n)),s("/olympiad/test-results/"+n)}catch(d){console.error("Failed to end exam:",d)}finally{w(!1)}},q=()=>{y(!0)},B=()=>{y(!1)},U=()=>t==null?void 0:t.examData.questions[x],V=d=>{if(!t)return null;const j=t.examData.studentAnswer.find(O=>O.questionId===d);return j?j.selectedOptionId:null},H=()=>t?new Set(t.examData.studentAnswer.map(j=>j.questionId)).size:0;if(a||!t)return e.jsx(P,{children:e.jsx(f,{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh",children:e.jsx(F,{size:60,sx:{color:"white"}})})});if(r)return e.jsx(P,{children:e.jsx(z,{maxWidth:"md",sx:{mt:4},children:e.jsx(I,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsxs(b,{elevation:0,children:[e.jsx(M,{severity:"error",sx:{mb:3},children:r}),e.jsx(v,{sx:{mt:2},onClick:()=>s("/olympiad/dashboard"),children:"Вернуться на главную"})]})})})});const D=U(),A=t.examData.questions.length,G=H();return e.jsx(P,{children:e.jsxs(z,{maxWidth:"lg",children:[e.jsx(I,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(b,{elevation:0,children:e.jsxs(W,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(W,{item:!0,xs:12,sm:8,children:[e.jsx(p,{variant:"h5",component:"h1",fontWeight:"600",children:t.examData.nameRus}),e.jsx(p,{variant:"subtitle1",color:"text.secondary",children:t.examData.typeRus})]}),e.jsxs(W,{item:!0,xs:12,sm:4,sx:{textAlign:{xs:"left",sm:"right"},mt:{xs:2,sm:0}},children:[e.jsx(Se,{remainingSeconds:h(),onTimeExpired:E}),e.jsxs(p,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Вопросов отвечено: ",G," из ",A]})]})]})})}),S&&e.jsx(M,{severity:"warning",sx:{mb:3,borderRadius:3,boxShadow:"0 6px 20px rgba(255, 152, 0, 0.15)"},children:"Внимание! Осталось меньше минуты до окончания теста. Тест будет автоматически завершен."}),D&&e.jsx(I,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},children:e.jsxs(b,{elevation:0,children:[e.jsxs(p,{variant:"subtitle1",fontWeight:600,color:"primary",gutterBottom:!0,children:["Вопрос ",x+1," из ",A]}),e.jsx(we,{question:D,selectedOptionId:V(D.id),onSelectOption:L}),e.jsxs(f,{sx:{mt:4,display:"flex",justifyContent:"space-between"},children:[e.jsx(k,{variant:"outlined",startIcon:e.jsx(xe,{}),disabled:x===0,onClick:$,sx:{borderRadius:3},children:"Предыдущий"}),x<A-1?e.jsx(k,{variant:"outlined",color:"primary",endIcon:e.jsx(ye,{}),onClick:m,sx:{borderRadius:3},children:"Следующий"}):e.jsx(k,{variant:"contained",color:"primary",endIcon:e.jsx(Ce,{}),onClick:q,sx:{borderRadius:3},children:"Завершить тест"})]})]})}),e.jsx(I,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:e.jsxs(b,{elevation:0,children:[e.jsx(ve,{questions:t.examData.questions,currentIndex:x,answers:t.examData.studentAnswer,onQuestionSelect:d=>g(d)}),e.jsx(f,{sx:{mt:4,textAlign:"center"},children:e.jsx(k,{variant:"contained",color:"secondary",size:"large",onClick:q,disabled:C,sx:{borderRadius:3,px:6,py:1.5,boxShadow:"0 8px 16px rgba(245, 178, 7, 0.2)"},children:C?e.jsx(F,{size:24}):"Завершить тест"})})]})}),e.jsxs(ie,{open:T,onClose:B,PaperProps:{sx:{borderRadius:4,boxShadow:"0 24px 38px rgba(0, 0, 0, 0.14)"}},children:[e.jsx(oe,{children:"Завершить тест?"}),e.jsx(le,{children:e.jsxs(ce,{children:["Вы уверены, что хотите завершить тест? Вы ответили на ",G," из ",A," вопросов. После завершения вы не сможете изменить свои ответы."]})}),e.jsxs(de,{sx:{pb:3,pr:3},children:[e.jsx(v,{onClick:B,sx:{borderRadius:2,textTransform:"none"},children:"Отмена"}),e.jsx(v,{onClick:E,variant:"contained",color:"primary",autoFocus:!0,sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:"Завершить тест"})]})]})]})})};export{Pe as default};
