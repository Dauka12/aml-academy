import{r as m,c as W,j as e,d as z,e as J}from"./index-CWPAtMRT.js";const K=({percentage:r,score:p,description:n,recommendations:s,level:h})=>{const[a,t]=m.useState(0),o=W();m.useEffect(()=>{let d=0;const i=r===0?r=1:r,g=Math.abs(Math.floor(1e3/i)),l=setInterval(()=>{d+=1,t(d),d===i&&clearInterval(l)},g);return()=>clearInterval(l)},[r]);const v=()=>{o(`/courses/aml-games/game/read/1/${Number(h)}/1`)},c=a>70?"#1F3C88":"#ff4d4d";return e.jsxs("div",{className:"level-summary-container",children:[e.jsx("div",{className:"header",style:{backgroundColor:"rgba(31, 60, 136, 0.7)"},children:"Итог уровня"}),e.jsxs("div",{className:"circle-container",children:[e.jsx("div",{className:"circle",children:e.jsx("div",{className:"circle-inner",children:e.jsxs("div",{className:"circle-percentage",style:{color:c},children:[a,"%"]})})}),e.jsxs("svg",{className:"progress-ring",width:"180",height:"180",children:[e.jsx("circle",{className:"progress-ring__circle",stroke:"#E4E4E4",strokeWidth:"30",fill:"transparent",r:"75",cx:"90",cy:"90"}),e.jsx("circle",{className:"progress-ring__circle",stroke:c,strokeWidth:"30",fill:"transparent",r:"75",cx:"90",cy:"90",style:{strokeDasharray:"471",strokeDashoffset:471-471*a/100}})]})]}),e.jsxs("div",{className:"score",style:{color:c},children:["Баллы: ",p]}),e.jsx("div",{className:"description",children:n}),e.jsx("div",{className:"recommendations-title",children:"Рекомендации:"}),e.jsx("div",{className:"recommendations",children:s}),e.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center"},children:e.jsxs("button",{className:"reset-button",onClick:()=>{v()},children:[e.jsx("span",{className:"icon",children:"⟳"}),"Начать сначала"]})})]})},O=({level:r,title:p,subLevels:n})=>{const[s,h]=m.useState(n.map(()=>0));return m.useEffect(()=>{n.forEach((a,t)=>{const o=a.progress===0?1:a.progress,v=1e3,j=performance.now(),c=d=>{const i=d-j,u=Math.min(i/v*o,o);h(g=>{const l=[...g];return l[t]=u,l}),u<o&&requestAnimationFrame(c)};requestAnimationFrame(c)})},[n]),e.jsxs("div",{className:"level-progress-container",children:[e.jsx("div",{className:"level-header",style:{backgroundColor:"rgba(31, 60, 136, 0.7)"},children:e.jsx("span",{className:"level-title",children:`Уровень ${r} : ${p}`})}),n.map((a,t)=>e.jsxs("div",{className:"sublevel-container",children:[e.jsx("div",{className:"sublevel-title",children:a.title}),e.jsxs("div",{className:"progress-bar-container",children:[e.jsx("div",{className:"progress-bar",style:{width:`${s[t]}%`,backgroundColor:s[t]>30?"#0046FF":"#FF0000"}}),e.jsx("div",{className:"remaining-bar",style:{width:`${100-s[t]}%`,backgroundColor:"#D9D9D9"}})]}),e.jsx("div",{className:"status",children:s[t]>30?"Выполнено":"Не выполнено"})]},t))]})};function U({level:r}){var g,l,b,N,L,f,I,S,y,k,C,G,E,w,F,D,P,$,_,T,A,M,R,q,B,H;const p=W(),n=localStorage.getItem("jwtToken"),[s,h]=m.useState(null),[a,t]=m.useState(!0);m.useEffect(()=>{z.get(`${J}/api/aml/game/getResults`,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+n}}).then(x=>{h(x.data),t(!1)}).catch(x=>{console.error("Error fetching data:",x),t(!1)})},[n]);const o=s?[{title:"Задание 1.1 : Подача уведомления СФМ",progress:parseInt((l=(g=s[0])==null?void 0:g.userGameSubLevelList[0])==null?void 0:l.percentage)},{title:"Задание 1.2 : Определение ответственного лица по ПОД/ФТ",progress:parseInt((N=(b=s[0])==null?void 0:b.userGameSubLevelList[1])==null?void 0:N.percentage)},{title:"Задание 1.3 : Регистрация в личном кабинете портала ВЕБ-СФМ",progress:parseInt((f=(L=s[0])==null?void 0:L.userGameSubLevelList[2])==null?void 0:f.percentage)},{title:"Задание 1.4 : Формирование досье клиента",progress:parseInt((S=(I=s[0])==null?void 0:I.userGameSubLevelList[3])==null?void 0:S.percentage)},{title:"Задание 1.5 : Разработка анкеты «Знай своего клиента»",progress:parseInt((k=(y=s[0])==null?void 0:y.userGameSubLevelList[4])==null?void 0:k.percentage)}]:[],v=s?[{title:"Задание 2.1 : Оценка риска в зависимости от типа клиента",progress:parseInt((G=(C=s[1])==null?void 0:C.userGameSubLevelList[0])==null?void 0:G.percentage)},{title:"Задание 2.2 : Оценка странового риска",progress:parseInt((w=(E=s[1])==null?void 0:E.userGameSubLevelList[1])==null?void 0:w.percentage)},{title:"Задание 2.3 : Оценка риска услуги и продукта",progress:parseInt((D=(F=s[1])==null?void 0:F.userGameSubLevelList[2])==null?void 0:D.percentage)},{title:"Задание 2.4 : Оценка риска способа предоставления услуги",progress:parseInt(($=(P=s[1])==null?void 0:P.userGameSubLevelList[3])==null?void 0:$.percentage)}]:[],j=s?[{title:"Задание 3.1 :  Надлежащая проверка клиента",progress:parseInt((T=(_=s[2])==null?void 0:_.userGameSubLevelList[0])==null?void 0:T.percentage)}]:[],c=s?[{title:"Задание 4.1 :  Мониторинг операции",progress:parseInt((M=(A=s[3])==null?void 0:A.userGameSubLevelList[0])==null?void 0:M.percentage)}]:[],d=s?r===1?o:r===2?v:r===3?j:c:[],i=s?parseInt(r===1?(R=s[0])==null?void 0:R.percentage:r===2?(q=s[1])==null?void 0:q.percentage:r===3?(B=s[2])==null?void 0:B.percentage:(H=s[3])==null?void 0:H.percentage):"";if(a)return e.jsxs("div",{className:"loading-screen",children:[e.jsx("div",{className:"loading-text",children:"Подсчет результатов"}),e.jsx("div",{className:"loading-icon",children:"↻"})]});const u=i<70;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"result-page",children:[e.jsx("div",{className:"level-progress",children:e.jsx(O,{level:r,title:"Организация внутреннего контроля",subLevels:d})}),e.jsx("div",{className:"level-summary",children:e.jsx(K,{percentage:s?i:70,score:s?i:70,level:r,description:"Ты выполнил некоторые задания неверно. Возможно, тебе еще не до конца понятен учебный материал этого уровня. Для того чтобы пройти этот уровень нужно набрать больше 70%.",recommendations:"Для дальнейшего прогресса тебе важно активно работать над исправлением ошибок и заполнением пробелов в практических знаниях."})})]}),e.jsx("div",{className:"result-button-wrapper",children:e.jsx("div",{className:"result-button",children:e.jsx("button",{className:"blue",onClick:()=>{u||p(`/courses/aml-games/game/read/1/${Number(r)+1}/1`)},disabled:u,children:"Следующий уровень"})})})]})}export{U as default};
