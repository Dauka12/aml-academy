<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Navigation Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-checklist {
            background: #e1f5fe;
            border-left: 4px solid #0288d1;
            padding: 15px;
            margin: 20px 0;
        }
        .issue-fixed {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
        }
        .code-fix {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .success { color: #22c55e; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
        .info { color: #3b82f6; font-weight: bold; }
    </style>
</head>
<body>
    <h1>🐛 Module Navigation Debug Test</h1>
    
    <div class="issue-fixed">
        <h2>✅ Primary Issue Identified & Fixed</h2>
        <p><strong>Problem:</strong> Type mismatch between <code>activeSessionId</code> and <code>module.quiz.quiz_id</code></p>
        <p><strong>Root Cause:</strong> JavaScript strict comparison (===) failing when one value is string and another is number</p>
    </div>

    <div class="debug-section">
        <h3>🔧 Applied Fixes</h3>
        
        <h4>1. Enhanced courseStore.js logging:</h4>
        <div class="code-fix">// Added detailed logging to setActiveQuiz function
setActiveQuiz: (moduleId, quizId) => {
  console.log('🎯 courseStore setActiveQuiz called:', { moduleId, quizId });
  console.log('🎯 Previous state:', {
    activeModuleId: get().activeModuleId,
    activeSessionId: get().activeSessionId,
    isModuleQuiz: get().isModuleQuiz
  });
  
  set({
    activeModuleId: moduleId,
    activeQuizId: quizId,
    isModuleQuiz: true,
    activeSessionId: quizId  // ✅ Fixed: was null, now quizId
  });
  
  console.log('🎯 New state after setActiveQuiz:', {
    activeModuleId: get().activeModuleId,
    activeSessionId: get().activeSessionId,
    isModuleQuiz: get().isModuleQuiz
  });
}</div>

        <h4>2. Fixed type-safe comparisons in CourseNavigation.jsx:</h4>
        <div class="code-fix">// BEFORE (failed with type mismatch):
const hasActiveQuiz = module.quiz && isModuleQuiz && module.quiz.quiz_id === activeSessionId;

// AFTER (handles both string and number types):
const hasActiveQuiz = module.quiz && isModuleQuiz && 
    (module.quiz.quiz_id === activeSessionId || 
     Number(module.quiz.quiz_id) === Number(activeSessionId));</div>

        <h4>3. Added helper function for clean code:</h4>
        <div class="code-fix">// Helper function to check if quiz is active with type safety
const isQuizActive = (quizId) => {
    return isModuleQuiz && (activeSessionId === quizId || Number(activeSessionId) === Number(quizId));
};</div>

        <h4>4. Enhanced useCourseLogic.js logging:</h4>
        <div class="code-fix">// Added comprehensive logging to handleQuizClick
const handleQuizClick = useCallback((moduleId, quizId) => {
  console.log('🧪 useCourseLogic handleQuizClick called:', { moduleId, quizId });
  console.log('🔄 Current state before quiz navigation:', { 
    activeSessionId, 
    activeModuleId, 
    isModuleQuiz 
  });
  
  setActiveQuiz(moduleId, quizId);
  console.log('✅ setActiveQuiz called with:', { moduleId, quizId });
}, [setActiveQuiz, activeSessionId, activeModuleId, isModuleQuiz]);</div>
    </div>

    <div class="test-checklist">
        <h3>🧪 Testing Instructions</h3>
        <p>To verify the fix works, follow these steps:</p>
        <ol>
            <li><strong>Open Browser Console</strong> - Press F12 and go to Console tab</li>
            <li><strong>Navigate to Course</strong> - Open any course with modules and quizzes</li>
            <li><strong>Test Lesson Navigation:</strong>
                <ul>
                    <li>Click on a lesson → Check console for debug logs</li>
                    <li>Verify module auto-opens</li>
                    <li>Look for: <span class="highlight">🎯 Setting current module to: [module_id]</span></li>
                </ul>
            </li>
            <li><strong>Test Quiz Navigation:</strong>
                <ul>
                    <li>Click on a quiz → Check console for debug logs</li>
                    <li>Verify module auto-opens</li>
                    <li>Look for: <span class="highlight">🧪 useCourseLogic handleQuizClick called</span></li>
                    <li>Look for: <span class="highlight">🎯 courseStore setActiveQuiz called</span></li>
                    <li>Verify quiz gets highlighted with yellow accent</li>
                </ul>
            </li>
            <li><strong>Test Cross-Module Navigation:</strong>
                <ul>
                    <li>Navigate from lesson in Module A to quiz in Module B</li>
                    <li>Verify Module B opens automatically</li>
                    <li>Verify Module A closes</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="debug-section">
        <h3>🔍 Expected Console Output</h3>
        <p>When clicking on a quiz, you should see this sequence in console:</p>
        <div class="code-fix">🧪 CourseNavigation handleQuizClick: {moduleId: 1, quizId: 5, moduleWithQuiz: "Module Name"}
📤 Opening module for quiz: 1
🧪 useCourseLogic handleQuizClick called: {moduleId: 1, quizId: 5}
🔄 Current state before quiz navigation: {activeSessionId: 3, activeModuleId: 1, isModuleQuiz: false}
🎯 courseStore setActiveQuiz called: {moduleId: 1, quizId: 5}
🎯 Previous state: {activeModuleId: 1, activeSessionId: 3, isModuleQuiz: false}
🎯 New state after setActiveQuiz: {activeModuleId: 1, activeSessionId: 5, isModuleQuiz: true}
🔍 Checking module: 1 {hasActiveLesson: false, hasActiveQuiz: true, activeSessionId: 5, ...}
🎯 Setting current module to: 1 Module Name</div>
    </div>

    <div class="debug-section">
        <h3>📊 Key Debug Points</h3>
        <ul>
            <li><span class="info">activeSessionId type:</span> Should show in console logs</li>
            <li><span class="info">moduleQuizId type:</span> Should show in console logs</li>
            <li><span class="info">strictComparison result:</span> Should be true for active quiz</li>
            <li><span class="info">numericComparison result:</span> Should be true even if types differ</li>
            <li><span class="success">hasActiveQuiz:</span> Should be true when quiz is active</li>
            <li><span class="success">Module auto-open:</span> Should work for both lessons and quizzes</li>
        </ul>
    </div>

    <div class="debug-section">
        <h3>🎯 Common Issues & Solutions</h3>
        
        <h4>Issue: Module doesn't open for quizzes</h4>
        <p><span class="warning">Check:</span> activeSessionId value and type in console</p>
        <p><span class="success">Solution:</span> The type-safe comparison should now handle this</p>
        
        <h4>Issue: Quiz doesn't get highlighted</h4>
        <p><span class="warning">Check:</span> isModuleQuiz flag and activeSessionId match</p>
        <p><span class="success">Solution:</span> The isQuizActive helper function now handles type conversion</p>
        
        <h4>Issue: State not updating</h4>
        <p><span class="warning">Check:</span> setActiveQuiz function logs in console</p>
        <p><span class="success">Solution:</span> Enhanced logging should show state transitions</p>
    </div>

    <script>
        console.log('🔧 Module Navigation Debug Test Page Loaded');
        console.log('📋 This page helps debug the module navigation fix');
        console.log('⚡ Key improvements:');
        console.log('   1. Fixed setActiveQuiz to use quizId instead of null');
        console.log('   2. Added type-safe comparisons for activeSessionId');
        console.log('   3. Enhanced logging throughout the navigation flow');
        console.log('   4. Created helper function for quiz active state');
        console.log('');
        console.log('🧪 To test: Open the course application and check console while navigating');
        
        // Simulate what the fix should show
        const simulateQuizNavigation = () => {
            console.log('');
            console.log('📝 SIMULATED QUIZ NAVIGATION (what you should see):');
            console.log('🧪 CourseNavigation handleQuizClick:', {moduleId: 1, quizId: 5});
            console.log('🧪 useCourseLogic handleQuizClick called:', {moduleId: 1, quizId: 5});
            console.log('🎯 courseStore setActiveQuiz called:', {moduleId: 1, quizId: 5});
            console.log('🎯 New state after setActiveQuiz:', {activeSessionId: 5, isModuleQuiz: true});
            console.log('🔍 Checking module: 1 hasActiveQuiz: true');
            console.log('🎯 Setting current module to: 1');
            console.log('✅ Module navigation should now work for quizzes!');
        };
        
        setTimeout(simulateQuizNavigation, 2000);
    </script>
</body>
</html>
